const formatNumber = n => {
    n = n.toString()
    return n[1] ? n : '0' + n
}

const getRemainTime = (endTime) => {
    const date = new Date();
    const timestamp = date.getTime();
    let t = endTime - timestamp;
    let seconds = formatNumber(Math.floor((t / 1000) % 60))
    let minutes = formatNumber(Math.floor((t / 1000 / 60) % 60))
    let hours = Math.floor((t / (1000 * 60 * 60)) % 24)
    let days = Math.floor(t / (1000 * 60 * 60 * 24))
    return {
        'total': t,
        'days': days,
        'hours': hours,
        'minutes': minutes,
        'seconds': seconds
    }
}

const getCountDownTime = (endTime, timeCb, endCb) => {
    const intervalTimer = () => {
        const remainTime = getRemainTime(endTime)
        const hours = remainTime.days * 24 + remainTime.hours;
        const time = {
            hours: hours >= 0 ? formatNumber(hours) : "00",
            minutes: remainTime.minutes >= 0 ? remainTime.minutes : "00",
            seconds: remainTime.seconds >= 0 ? remainTime.seconds : "00"
        }
        //倒计时结束
        if (remainTime.total >= 0) {
            if(timeCb) timeCb(time);
            //setTimeout(intervalTimer,1000);
        } else {
            if (endCb) endCb();
            clearInterval(intervalEmiter);
        }
    };

    const intervalEmiter = setInterval(intervalTimer,1000);
}

module.exports = {
    formatNumber,
    getRemainTime,
    getCountDownTime
}